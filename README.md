# Звіт

### Код програми:
(https://github.com/Masonishche/ASPZ_Pr6/blob/main/task23.c)

Мета завдання полягала у вивченні, як кількість арен у менеджері пам'яті jemalloc впливає на ступінь фрагментації пам'яті під час інтенсивних операцій виділення та звільнення пам'яті у FreeBSD. Алокатор jemalloc використовує арени - окремі області пам'яті - для керування ресурсами. Збільшення кількості арен зменшує конкуренцію між потоками за доступ до пам'яті, але може призвести до зростання фрагментації. Наше завдання полягало у перевірці цього компромісу на практиці.

Програма була реалізована мовою C з використанням специфічних функцій FreeBSD. Вона систематично тестує роботу з 1, 2, 4 та 8 аренами. Кожен тест запускається у окремому процесі для гарантії чистих умов експерименту. Функція run_test() виконує ключові дії: створює вказану кількість арен через системний виклик mallctl("arenas.create"), виділяє 100 000 блоків пам'яті випадкового розміру (від 1 до 512 байт), причому кожен блок призначається випадковій арені. Для імітації фрагментації програма звільняє кожен другий блок, створюючи характерний "візерунок" зайнятих та вільних ділянок пам'яті. Після цього збирається статистика: загальна виділена пам'ять (allocated), активна пам'ять під керуванням арен (active) та реальне використання ОЗУ (resident). На основі цих даних розраховується абсолютна фрагментація (різниця між active та allocated) та відсоток фрагментації від активної пам'яті.

Аналіз роботи програми показує її ефективність у дослідженні поставленої проблеми. Створення окремих арен для кожного тесту дозволяє ізолювати експерименти, а використання окремих процесів гарантує, що кожен тест починається з чистою пам'яттю без впливу попередніх дій. Випадковий розподіл блоків між аренами імітує реальні умови роботи багатопоточних додатків. Звільнення кожного другого блоку створює контрольовану фрагментацію, подібну до тієї, що виникає у довгоживучих програмах. Вимірювання трьох ключових показників пам'яті дає змогу точно оцінити втрати через фрагментацію.

Результати роботи програми демонструють чітку тенденцію. Типовий вивід виглядає так:

![Знімок екрана 2025-06-05 232933](https://github.com/user-attachments/assets/21f19f36-950b-447c-864e-03f4558e2d1b)


![image](https://github.com/user-attachments/assets/923ef134-ed3d-494a-baef-a8f63b0c0dd8)

Аналіз результатів підтверджує гіпотезу про пряму залежність між кількістю арен та ступенем фрагментації. Кожна додаткова арена збільшує втрати пам'яті через те, що вільні ділянки в одній арені не можуть бути використані для виділення в іншій. Це створює "острови" неефективно використаної пам'яті, які накопичуються з часом. Особливо виразно цей ефект проявляється у довгоживучих програмах, таких як сервери баз даних або веб-сервери, які можуть зіткнутися з ситуацією, коли загалом вільна пам'ять є, але через фрагментацію неможливо виділити великий єдиний блок.

Цей компроміс між продуктивністю та ефективністю використання пам'яті має важливі практичні наслідки. Для однопоточних додатків оптимально використовувати одну арену, що мінімізує фрагментацію. У багатопоточних середовищах кількість арен варто обирати приблизно рівною кількості ядер процесора - це дає гарний баланс між продуктивністю та ефективністю. Для критичних сервісів, які працюють безперервно протягом тривалого часу, рекомендується періодичний перезапуск для скидання накопиченої фрагментації.

### Висновок 
Дослідження полягає в тому, що кількість арен у jemalloc безпосередньо впливає на ефективність використання пам'яті. Оптимальне налаштування арен є компромісом між продуктивністю багатопоточних додатків та ефективним використанням пам'яті, і має враховувати специфіку конкретного застосування. Результати цього експерименту допомагають приймати обґрунтовані рішення при налаштуванні серверних додатків на FreeBSD, де правильне керування пам'яттю часто є ключем до стабільної роботи.
